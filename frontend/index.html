<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZS Ferramenta</title>
<style>
  body { font-family: Arial; margin:0; padding:0; display:flex; justify-content:center; align-items:center; height:100vh; background:#222; color:#fff;}
  .modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center; }
  .modal-content { background:#333; padding:20px; border-radius:10px; width:90%; max-width:500px; }
  .cards { display:flex; flex-wrap:wrap; gap:10px; margin-top:20px;}
  .card { background:#444; padding:10px; border-radius:5px; flex:1; cursor:pointer; }
  button { padding:8px 15px; margin-top:10px; }
</style>
</head>
<body>
<div class="content">
  <h1>ZS Ferramenta</h1>
  <div class="cards">
    <div class="card" onclick="abrirModal()">Encontrar Cliente</div>
  </div>
</div>

<div class="modal" id="modal" style="display:none;">
  <div class="modal-content">
    <h2>Buscar Estabelecimento</h2>
    <input type="text" id="nicho" placeholder="Qual o nicho?"><br>
    <input type="text" id="estado" placeholder="Qual o estado?"><br>
    <button onclick="buscar()">Pesquisar</button>
    <button onclick="fecharModal()">Fechar</button>
    <div id="resultados" style="margin-top:15px;"></div>
  </div>
</div>

<script>
function abrirModal() { document.getElementById('modal').style.display='flex'; }
function fecharModal() { document.getElementById('modal').style.display='none'; document.getElementById('resultados').innerHTML=''; }

async function buscar() {
  const nicho = document.getElementById('nicho').value;
  const estado = document.getElementById('estado').value;
  const resDiv = document.getElementById('resultados');
  resDiv.innerHTML = 'Carregando...';

  try {
    const response = await fetch('/api/buscar', {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ nicho, estado })
    });
    const results = await response.json();
    resDiv.innerHTML = '';
    results.forEach(r => {
      const div = document.createElement('div');
      div.className='card';
      div.innerHTML = `<strong>${r.name}</strong><br>${r.address}<br>${r.phone ? `<a href="${r.whatsapp}" target="_blank">WhatsApp</a>` : ''}`;
      resDiv.appendChild(div);
    });
  } catch(e) {
    resDiv.innerHTML = 'Erro ao buscar';
  }
}
</script>
</body>
</html>
